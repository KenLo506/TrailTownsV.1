// Firestore Security Rules for TrailTowns MVP

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Users can read any user profile, but can only modify their own.
    // For MVP, allow unauthenticated users to write (using anonymous IDs)
    match /users/{userId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Stamps: anyone can read and create (for MVP/testing)
    // TODO: Add authentication and restrict updates/deletes to creator
    match /stamps/{stampId} {
      allow read: if true;
      allow create: if true; // Allow unauthenticated for MVP
      allow update: if true; // Allow updates for likes/dislikes
      allow delete: if true; // Allow deletes for MVP (restrict to creator in production)
    }

    // Collectibles: read-only for clients.
    match /collectibles/{id} {
      allow read: if true;
      allow write: if false;
      allow create: if true; // Allow creation for initialization
      allow update, delete: if false;
    }

    // Leaderboards: only Cloud Functions can write.
    match /leaderboards/{region} {
      allow read: if true;
      allow write: if request.auth.token.admin == true;
    }
  }
}
